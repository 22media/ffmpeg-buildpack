#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# constants
ffmpeg_download_file=ffmpeg-git-64bit-static.tar.xz
ffmpeg_download_url=http://johnvansickle.com/ffmpeg/builds/${ffmpeg_download_file}

# fail hard
set -o pipefail
# fail harder
set -eu
# move hidden files too, just in case
shopt -s dotglob

# define directories
build_dir=$1
cache_dir=$2/ffmpeg
build_ffmpeg_dir=${build_dir}/ffmpeg

echo "-----> Installing ffmpeg..."
if ls ${cache_dir}/${ffmpeg_download_file} &>/dev/null
then
    echo "Using cached ffmpeg at ${cache_dir}/${ffmpeg_download_file}..."
else
    echo "Downloading ffmpeg..."
    mkdir -p $cache_dir && cd $cache_dir
    curl -o $cache_dir/$ffmpeg_download_file $ffmpeg_download_url 
fi

mkdir ffmpeg-build && cd ffmpeg-build
tar xf $cache_dir/$ffmpeg_download_file

mkdir $build_ffmpeg_dir
mv `ls`/* $build_ffmpeg_dir

ls -laH $build_ffmpeg_dir
