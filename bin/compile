#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# constants
FFMPEG_DOWNLOAD_URL=https://s3.amazonaws.com/static.josephprince.com/ffmpeg/ffmpeg

# fail hard
set -o pipefail
# fail harder
set -eu
# move hidden files too, just in case
shopt -s dotglob

# define directories
BUILD_DIR=$1
CACHE_DIR=$2/bin
FFMPEG_DIR=${BUILD_DIR}/bin

echo "-----> Installing ffmpeg..."
if ls ${CACHE_DIR}/ffmpeg &>/dev/null
then
    echo "Using cached ffmpeg at ${CACHE_DIR}/ffmpeg..."
else
    echo "Downloading ffmpeg..."
    mkdir -p $CACHE_DIR && cd $CACHE_DIR
    curl -o ffmpeg $FFMPEG_DOWNLOAD_URL 
fi

mkdir -p $FFMPEG_DIR
mv ${CACHE_DIR}/ffmpeg $FFMPEG_DIR

ls -laH $FFMPEG_DIR
